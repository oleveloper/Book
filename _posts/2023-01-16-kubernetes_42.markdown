---
layout: post
title: "Kubernetes_42 Authentication"
date: 2023-01-16
last_modified_at: 2023-01-16
categories: [Kubernetes]
tags: [Kubernetes]
---

# Authentication

이미 살펴본 바와 같이 쿠버네티스 클러스터는 물리적 또는 가상의 여러 노드와 함께 작동하는 다양한 구성 요소로 구성된다.   
관리 작업을 수행하기 위해 클러스터에 액세스하는 관리자, 애플리케이션을 테스트하거나 배포하기 위해 클러스터에 액세스하는 개발자와 같은 사용자가 있다.   

클러스터에 구축된 애플리케이션에 액세스하는 최종 사용자(end users)와 통합 목적으로 클러스터에 액세스하는 third party 애플리케이션이 있다.   
이 포스팅에서는 내부 구성 요소 간의 통신을 보호하고 인증 및 권한 부여 메커니즘을 통해 클러스터에 대한 securing access를 보호하여 클러스터를 보호하는 방법에 대해 설명한다. 또한 인증 메커니즘을 사용하여 쿠버네티스 클러스터에 대한 액세스를 확보하는 데 중점을 둔다.   

앞서 클러스터에 액세스할 수 있는 다양한 사용자에 대해 이야기했다.   
클러스터에 배포된 애플리케이션에 액세스하는 최종 사용자의 보안은 애플리케이션 자체가 내부적으로 관리한다.   
그래서 이것들은 논의에서 제외할 것이다.   

중요한 부분은 관리 목적을 위한 Kubernetes 클러스터에 대한 사용자의 액세스에 있으므로 두 가지 유형의 사용자를 나누어 볼 것이다:    
하나는 관리자 및 개발자, 다른 하나는 프로세스나 서비스 같은 로봇 또는 클러스터에 대한 액세스가 필요한 애플리케이션이다.   

쿠버네티스는 기본적으로 사용자 계정을 관리하지 않는다.   
사용자 세부 정보가 있는 파일이나 인증서와 같은 외부 소스 또는 LDAP과 같은 타사 ID 서비스를 사용하여 이러한 사용자를 관리한다.   
따라서 Kubernetes 클러스터에서 사용자를 생성하거나 이러한 사용자 목록을 볼 수 없다.   

다만 서비스 계정의 경우 쿠버네티스가 관리할 수 있다.   
Kubernetes API를 사용하여 서비스 계정을 만들고 관리할 수 있다.   
이 포스팅에서는 쿠버네티스 사용자들을 중심으로 진행될 것이다.   

모든 사용자 액세스는 Kube Control 도구를 통해 클러스터에 액세스하든 API를 통해 직접 액세스하든 API 서버에 의해 관리된다.   
이러한 모든 요청은 Kube API Server를 통해 이루어진다.   
Kube API Server는 요청을 처리하기 전에 인증한다.   

그렇다면 Kube API Server는 어떻게 인증할까?   
Configure할 수 있는 다양한 인증 메커니즘이 있다.   
static password file에 사용자 이름 및 password 목록을 통해 인증할 수 있다. 또는 static token file에 사용자 이름 및 토큰이 있거나 인증서를 사용하여 인증할 수 있다.   
다른 옵션은 LDAP, Kerberos 등과 같은 타사 인증 프로토콜에 연결하는 것이다.   

static password와 token file이 가장 이해하기 쉽기 때문에 먼저 설명하도록 한다.   
가장 간단한 인증 형식으로 먼저 시작해 볼 것이다.   
CSV 파일에 사용자 및 암호 목록을 생성하여 사용자 정보의 원본으로 사용할 수 있다.   
파일에는 암호, 사용자 이름 및 사용자 ID의 세 가지 column이 있다.   
그런 다음 파일 이름을 Kube API Server에 옵션으로 전달한다.   

Kube API Server 서비스와 이 과정의 앞부분에서 살펴본 다양한 옵션을 기억할 것이다.   
여기서 이 옵션을 지정해야 한다.   
그런 다음 이러한 옵션을 적용하려면 Kube API 서버를 재시작해야 한다.   

Kube ADM 도구를 사용하여 클러스터를 설정하는 경우 Kube API Server 포드 정의 파일을 수정해야 한다.    
이 파일을 업데이트하면 Kube ADM 도구가 Kube API Server를 자동으로 다시 시작한다.   

API 서버에 액세스하는 동안 기본 자격 증명을 사용하여 인증하려면 다음과 같이 curl 명령으로 사용자와 암호를 지정한다.   
```
```
사용자 세부 정보가 포함된 CSV 파일에서 선택적으로 그룹 세부 정보가 포함된 네 번째 column을 사용하여 특정 그룹에 사용자를 할당할 수 있다.   
마찬가지로, static password file 대신 static token file을 여기에 사용할 수 있으며, 암호 대신 토큰을 지정할 수 있다.   
토큰 파일을 옵션 토큰 인증 파일로 Kube API Server에 전달하는 동시에 인증확인을 통해 토큰을 다음과 같이 요청에 대한 authorization bearer token으로 지정한다.   

(*) 사용자 이름, 암호 및 토큰을 정적 파일의 일반 텍스트에 저장하는 이 인증 메커니즘은 안전하지 않기 때문에 권장되지 않는다.
